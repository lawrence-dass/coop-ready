# Testing Guide

See main guide: [CLAUDE.md](../CLAUDE.md)

---

## Test Structure

```
tests/
├── unit/              # Vitest unit tests (*.test.ts)
│   ├── actions/       # Server action tests
│   └── hooks/         # React hook tests
├── integration/       # Mixed integration tests
│   ├── *.test.tsx     # Vitest integration tests
│   └── *.spec.ts      # Playwright integration tests
├── api/               # Playwright API tests (*.spec.ts)
├── e2e/               # Playwright e2e tests (*.spec.ts)
└── support/           # Test helpers & fixtures
```

---

## Test Runner Separation

**Vitest:** `*.test.ts` / `*.test.tsx` (unit + integration)
**Playwright:** `*.spec.ts` (e2e + api + integration)

**Why separate?** Prevents ESM/CJS conflicts (Vitest requires ES modules, Playwright is flexible)

---

## Test Priority Tags

Use tags in test names for CI optimization:
- `@P0` - Critical path (must pass for merge)
- `@P1` - Important features (run on main)
- `@P2` - Nice-to-have (run nightly)

Example:
```typescript
test('[P0] should upload PDF successfully', async () => {
  // Critical test
});
```

---

## Test Commands

```bash
# Unit Tests (Vitest)
npm run test:unit         # Watch mode
npm run test:unit:run     # CI mode (run once)

# E2E Tests (Playwright)
npm run test:e2e          # All e2e tests
npm run test:e2e:p0       # Only @P0 tests
npm run test:e2e:p1       # Run @P0 and @P1 tests
npm run test:e2e:headed   # Show browser
npm run test:e2e:ui       # Interactive UI mode

# All Tests
npm run test:all          # Unit + E2E (CI workflow)
```

---

## Test Artifacts

- **Playwright reports:** `playwright-report/`
- **Test artifacts:** `playwright-artifacts/` (screenshots, videos, traces)
- **Coverage:** Generated by Vitest

